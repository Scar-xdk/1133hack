<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>kdefy</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-sidebar: #1a1a1a;
            --text-primary: #1a1a1a;
            --text-secondary: #6c757d;
            --text-light: #ffffff;
            --border-color: #e9ecef;
            --income-color: #00C853;
            --expense-color: #FF3D00;
            --accent-color: #5B2CFF;
            --shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        [data-theme="dark"] {
            --bg-primary: #1a1a1a;
            --bg-secondary: #2d2d2d;
            --bg-sidebar: #0d0d0d;
            --text-primary: #ffffff;
            --text-secondary: #adb5bd;
            --border-color: #404040;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-secondary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: var(--bg-sidebar);
            color: var(--text-light);
            display: flex;
            flex-direction: column;
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .sidebar.collapsed {
            transform: translateX(-260px);
        }

        .sidebar-header {
            padding: 24px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .sidebar-toggle {
            background: transparent;
            border: none;
            color: var(--text-light);
            cursor: pointer;
            font-size: 20px;
            padding: 5px;
            transition: opacity 0.2s;
        }

        .sidebar-toggle:hover {
            opacity: 0.7;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-light);
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.2s;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-light);
            text-decoration: none;
        }

        .menu-item:hover, .menu-item.active {
            background: rgba(255,255,255,0.1);
            border-left: 3px solid var(--accent-color);
        }

        .main-wrapper {
            flex: 1;
            margin-left: 260px;
            transition: margin-left 0.3s ease;
        }

        .main-wrapper.expanded {
            margin-left: 0;
        }

        .topbar {
            background: var(--bg-primary);
            padding: 20px 30px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .balance-display {
            font-size: 28px;
            font-weight: 600;
        }

        .balance-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: #4a1fd9;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-income {
            background: var(--income-color);
            color: white;
        }

        .btn-expense {
            background: var(--expense-color);
            color: white;
        }

        .main-content {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 24px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
        }

        .chart-container {
            position: relative;
            height: 300px;
        }

        .transactions-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .transaction-category {
            font-size: 14px;
            font-weight: 500;
        }

        .transaction-date {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .transaction-value {
            font-weight: 600;
            font-size: 16px;
        }

        .transaction-value.income {
            color: var(--income-color);
        }

        .transaction-value.expense {
            color: var(--expense-color);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 22px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-family: 'Inter', sans-serif;
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--accent-color);
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .category-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .category-item {
            padding: 16px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
            border: 2px solid transparent;
        }

        .category-item:hover {
            transform: scale(1.05);
        }

        .category-name {
            font-weight: 500;
            margin-top: 8px;
        }

        .color-picker-wrapper {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-picker {
            width: 60px;
            height: 40px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
        }

        .settings-group {
            margin-bottom: 30px;
        }

        .settings-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 16px;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px 0;
            border-bottom: 1px solid var(--border-color);
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--accent-color);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .filter-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .contract-preview {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            line-height: 1.8;
            max-height: 500px;
            overflow-y: auto;
        }

        .contract-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .contract-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .contract-section {
            margin-bottom: 20px;
        }

        .contract-section-title {
            font-weight: 600;
            margin-bottom: 10px;
        }

        .button-group {
            display: flex;
            gap: 12px;
        }

        .sidebar-open-btn {
            position: fixed;
            left: 10px;
            top: 10px;
            z-index: 999;
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 6px;
            cursor: pointer;
            display: none;
            font-size: 18px;
        }

        .sidebar-open-btn.visible {
            display: block;
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .contract-preview, .contract-preview * {
                visibility: visible;
            }
            .contract-preview {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <button class="sidebar-open-btn" id="sidebarOpenBtn" onclick="toggleSidebar()">‚ò∞</button>

    <div class="app-container">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">kdefy</div>
                <button class="sidebar-toggle" onclick="toggleSidebar()">‚úï</button>
            </div>
            <nav class="sidebar-menu">
                <div class="menu-item active" onclick="showSection('dashboard')">
                    üìä Dashboard
                </div>
                <div class="menu-item" onclick="showSection('transactions')">
                    üí∞ Transa√ß√µes
                </div>
                <div class="menu-item" onclick="showSection('categories')">
                    üè∑Ô∏è Categorias
                </div>
                <div class="menu-item" onclick="showSection('contracts')">
                    üìÑ Contratos
                </div>
                <div class="menu-item" onclick="showSection('reports')">
                    üìà Relat√≥rios
                </div>
                <div class="menu-item" onclick="showSection('settings')">
                    ‚öôÔ∏è Configura√ß√µes
                </div>
            </nav>
        </aside>

        <div class="main-wrapper" id="mainWrapper">
            <header class="topbar">
                <div>
                    <div class="balance-label">Saldo Total</div>
                    <div class="balance-display" id="totalBalance">R$ 0,00</div>
                </div>
                <button class="btn btn-primary" onclick="openTransactionModal()">+ Adicionar Transa√ß√£o</button>
            </header>

            <main class="main-content">
                <section id="dashboard" class="section active">
                    <div class="dashboard-grid">
                        <div class="card">
                            <h2 class="card-title">Entradas vs Sa√≠das</h2>
                            <div class="chart-container">
                                <canvas id="incomeExpenseChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h2 class="card-title">Distribui√ß√£o por Categoria</h2>
                            <div class="chart-container">
                                <canvas id="categoryChart"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <h2 class="card-title">√öltimas Transa√ß√µes</h2>
                        <div class="transactions-list" id="recentTransactions"></div>
                    </div>
                </section>

                <section id="transactions" class="section">
                    <div class="card">
                        <h2 class="card-title">Gerenciar Transa√ß√µes</h2>
                        <div class="filter-group">
                            <input type="date" class="form-input" id="filterStartDate" onchange="loadTransactions()">
                            <input type="date" class="form-input" id="filterEndDate" onchange="loadTransactions()">
                            <select class="form-select" id="filterCategory" onchange="loadTransactions()">
                                <option value="">Todas as categorias</option>
                            </select>
                        </div>
                        <div class="transactions-list" id="allTransactions"></div>
                    </div>
                </section>

                <section id="categories" class="section">
                    <div class="card">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2 class="card-title" style="margin: 0;">Categorias</h2>
                            <button class="btn btn-primary" onclick="openCategoryModal()">+ Adicionar Categoria</button>
                        </div>
                        <div class="category-list" id="categoryList"></div>
                    </div>
                </section>

                <section id="contracts" class="section">
                    <div class="card">
                        <h2 class="card-title">Gerador de Contratos</h2>
                        <div class="form-group">
                            <label class="form-label">Tipo de Contrato</label>
                            <select class="form-select" id="contractType" onchange="updateContractPreview()">
                                <option value="service">Presta√ß√£o de Servi√ßos</option>
                                <option value="work">Contrato de Trabalho</option>
                                <option value="rent">Loca√ß√£o de Im√≥vel</option>
                                <option value="sales">Compra e Venda</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nome do Contratante</label>
                            <input type="text" class="form-input" id="contractorName" oninput="updateContractPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">CPF/CNPJ do Contratante</label>
                            <input type="text" class="form-input" id="contractorDoc" oninput="updateContractPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nome do Contratado</label>
                            <input type="text" class="form-input" id="contractedName" oninput="updateContractPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">CPF/CNPJ do Contratado</label>
                            <input type="text" class="form-input" id="contractedDoc" oninput="updateContractPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Valor do Contrato (R$)</label>
                            <input type="number" class="form-input" id="contractValue" oninput="updateContractPreview()">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o do Objeto</label>
                            <textarea class="form-textarea" id="contractObject" oninput="updateContractPreview()"></textarea>
                        </div>
                        
                        <h3 class="card-title">Pr√©-visualiza√ß√£o</h3>
                        <div class="contract-preview" id="contractPreview"></div>
                        
                        <div class="button-group">
                            <button class="btn btn-primary" onclick="copyContract()">üìã Copiar Contrato</button>
                            <button class="btn btn-secondary" onclick="downloadContractPDF()">üìÑ Baixar PDF</button>
                        </div>
                    </div>
                </section>

                <section id="reports" class="section">
                    <div class="dashboard-grid">
                        <div class="card">
                            <h2 class="card-title">Evolu√ß√£o Mensal</h2>
                            <div class="chart-container">
                                <canvas id="monthlyChart"></canvas>
                            </div>
                        </div>
                        <div class="card">
                            <h2 class="card-title">Comparativo de Categorias</h2>
                            <div class="chart-container">
                                <canvas id="categoryBarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="settings" class="section">
                    <div class="card">
                        <h2 class="card-title">Configura√ß√µes</h2>
                        <div class="settings-group">
                            <h3 class="settings-title">Apar√™ncia</h3>
                            <div class="settings-item">
                                <span>Tema Escuro</span>
                                <label class="toggle-switch">
                                    <input type="checkbox" id="themeToggle" onchange="toggleTheme()">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <div class="settings-group">
                            <h3 class="settings-title">Dados</h3>
                            <div class="settings-item">
                                <span>Backup de Dados</span>
                                <button class="btn btn-secondary" onclick="exportData()">Exportar JSON</button>
                            </div>
                            <div class="settings-item">
                                <span>Restaurar Dados</span>
                                <input type="file" id="importFile" accept=".json" style="display: none" onchange="importData(event)">
                                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Importar JSON</button>
                            </div>
                            <div class="settings-item">
                                <span>Limpar Todos os Dados</span>
                                <button class="btn btn-expense" onclick="clearAllData()">Limpar Tudo</button>
                            </div>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div class="modal" id="transactionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="transactionModalTitle">Adicionar Transa√ß√£o</h2>
                <button class="close-btn" onclick="closeTransactionModal()">√ó</button>
            </div>
            <form id="transactionForm" onsubmit="saveTransaction(event)">
                <input type="hidden" id="transactionId">
                <div class="form-group">
                    <label class="form-label">Tipo</label>
                    <select class="form-select" id="transactionType" required>
                        <option value="income">Entrada</option>
                        <option value="expense">Sa√≠da</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Valor</label>
                    <input type="number" class="form-input" id="transactionValue" step="0.01" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Categoria</label>
                    <select class="form-select" id="transactionCategory" required></select>
                </div>
                <div class="form-group">
                    <label class="form-label">Data</label>
                    <input type="date" class="form-input" id="transactionDate" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Descri√ß√£o</label>
                    <textarea class="form-textarea" id="transactionDescription"></textarea>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar</button>
            </form>
        </div>
    </div>

    <div class="modal" id="categoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Adicionar Categoria</h2>
                <button class="close-btn" onclick="closeCategoryModal()">√ó</button>
            </div>
            <form id="categoryForm" onsubmit="saveCategory(event)">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label class="form-label">Nome</label>
                    <input type="text" class="form-input" id="categoryName" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Cor</label>
                    <div class="color-picker-wrapper">
                        <input type="color" class="color-picker" id="categoryColor" value="#5B2CFF">
                        <span id="colorValue">#5B2CFF</span>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%;">Salvar</button>
            </form>
        </div>
    </div>

    <script>
        let db;
        let charts = {};
        let currentTransactionId = null;

        const contractTemplates = {
            service: {
                title: 'CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS',
                content: (data) => `
                    <p>Pelo presente instrumento particular, de um lado <strong>${data.contractorName || '[CONTRATANTE]'}</strong>, inscrito no CPF/CNPJ sob n¬∞ <strong>${data.contractorDoc || '[DOC]'}</strong>, doravante denominado CONTRATANTE, e de outro lado <strong>${data.contractedName || '[CONTRATADO]'}</strong>, inscrito no CPF/CNPJ sob n¬∞ <strong>${data.contractedDoc || '[DOC]'}</strong>, doravante denominado CONTRATADO, t√™m entre si justo e contratado o seguinte:</p>
                    
                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA PRIMEIRA - DO OBJETO</div>
                        <p>O presente contrato tem como objeto a presta√ß√£o de servi√ßos de ${data.contractObject || '[DESCRI√á√ÉO DO SERVI√áO]'}.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA SEGUNDA - DO VALOR</div>
                        <p>O CONTRATANTE pagar√° ao CONTRATADO o valor total de <strong>R$ ${parseFloat(data.contractValue || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong> pela presta√ß√£o dos servi√ßos descritos.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA TERCEIRA - DAS OBRIGA√á√ïES</div>
                        <p>O CONTRATADO se obriga a executar os servi√ßos com qualidade e dentro dos prazos estabelecidos, enquanto o CONTRATANTE se compromete a efetuar o pagamento conforme acordado.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA QUARTA - DO FORO</div>
                        <p>Fica eleito o foro da comarca de [CIDADE] para dirimir quaisquer quest√µes oriundas do presente contrato.</p>
                    </div>

                    <p style="margin-top: 40px;">E por estarem assim justos e contratados, assinam o presente instrumento em duas vias de igual teor.</p>

                    <p style="margin-top: 60px;">[CIDADE], [DATA]</p>

                    <div style="margin-top: 80px; display: flex; justify-content: space-between;">
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractorName || '[CONTRATANTE]'}</div>
                        </div>
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractedName || '[CONTRATADO]'}</div>
                        </div>
                    </div>
                `
            },
            work: {
                title: 'CONTRATO DE TRABALHO',
                content: (data) => `
                    <p>EMPREGADOR: <strong>${data.contractorName || '[EMPREGADOR]'}</strong>, inscrito no CNPJ sob n¬∞ <strong>${data.contractorDoc || '[CNPJ]'}</strong></p>
                    <p>EMPREGADO: <strong>${data.contractedName || '[EMPREGADO]'}</strong>, inscrito no CPF sob n¬∞ <strong>${data.contractedDoc || '[CPF]'}</strong></p>
                    
                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA PRIMEIRA - DA FUN√á√ÉO</div>
                        <p>O EMPREGADO exercer√° a fun√ß√£o de ${data.contractObject || '[CARGO/FUN√á√ÉO]'}.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA SEGUNDA - DA REMUNERA√á√ÉO</div>
                        <p>O EMPREGADO receber√° a remunera√ß√£o mensal de <strong>R$ ${parseFloat(data.contractValue || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA TERCEIRA - DA JORNADA</div>
                        <p>A jornada de trabalho ser√° conforme legisla√ß√£o vigente, respeitando-se os limites legais e intervalos obrigat√≥rios.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA QUARTA - DAS DISPOSI√á√ïES GERAIS</div>
                        <p>Aplicam-se a este contrato todas as disposi√ß√µes da CLT e legisla√ß√£o trabalhista vigente.</p>
                    </div>

                    <p style="margin-top: 60px;">[CIDADE], [DATA]</p>

                    <div style="margin-top: 80px; display: flex; justify-content: space-between;">
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractorName || '[EMPREGADOR]'}</div>
                        </div>
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractedName || '[EMPREGADO]'}</div>
                        </div>
                    </div>
                `
            },
            rent: {
                title: 'CONTRATO DE LOCA√á√ÉO DE IM√ìVEL',
                content: (data) => `
                    <p>LOCADOR: <strong>${data.contractorName || '[LOCADOR]'}</strong>, inscrito no CPF/CNPJ sob n¬∞ <strong>${data.contractorDoc || '[DOC]'}</strong></p>
                    <p>LOCAT√ÅRIO: <strong>${data.contractedName || '[LOCAT√ÅRIO]'}</strong>, inscrito no CPF/CNPJ sob n¬∞ <strong>${data.contractedDoc || '[DOC]'}</strong></p>
                    
                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA PRIMEIRA - DO IM√ìVEL</div>
                        <p>O LOCADOR d√° em loca√ß√£o ao LOCAT√ÅRIO o im√≥vel situado em ${data.contractObject || '[ENDERE√áO COMPLETO DO IM√ìVEL]'}.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA SEGUNDA - DO ALUGUEL</div>
                        <p>O valor mensal do aluguel √© de <strong>R$ ${parseFloat(data.contractValue || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>, a ser pago at√© o dia 10 de cada m√™s.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA TERCEIRA - DO PRAZO</div>
                        <p>O prazo de loca√ß√£o √© de [PER√çODO], com in√≠cio em [DATA IN√çCIO] e t√©rmino em [DATA FIM].</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA QUARTA - DAS OBRIGA√á√ïES</div>
                        <p>O LOCAT√ÅRIO se compromete a manter o im√≥vel em bom estado de conserva√ß√£o e utilizar o im√≥vel conforme sua destina√ß√£o.</p>
                    </div>

                    <p style="margin-top: 60px;">[CIDADE], [DATA]</p>

                    <div style="margin-top: 80px; display: flex; justify-content: space-between;">
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractorName || '[LOCADOR]'}</div>
                        </div>
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractedName || '[LOCAT√ÅRIO]'}</div>
                        </div>
                    </div>
                `
            },
            sales: {
                title: 'CONTRATO DE COMPRA E VENDA',
                content: (data) => `
                    <p>VENDEDOR: <strong>${data.contractorName || '[VENDEDOR]'}</strong>, inscrito no CPF/CNPJ sob n¬∞ <strong>${data.contractorDoc || '[DOC]'}</strong></p>
                    <p>COMPRADOR: <strong>${data.contractedName || '[COMPRADOR]'}</strong>, inscrito no CPF/CNPJ sob n¬∞ <strong>${data.contractedDoc || '[DOC]'}</strong></p>
                    
                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA PRIMEIRA - DO OBJETO</div>
                        <p>O VENDEDOR vende ao COMPRADOR ${data.contractObject || '[DESCRI√á√ÉO DO BEM/PRODUTO]'}.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA SEGUNDA - DO PRE√áO</div>
                        <p>O valor total da compra e venda √© de <strong>R$ ${parseFloat(data.contractValue || 0).toLocaleString('pt-BR', {minimumFractionDigits: 2})}</strong>.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA TERCEIRA - DO PAGAMENTO</div>
                        <p>O pagamento ser√° realizado conforme condi√ß√µes acordadas entre as partes.</p>
                    </div>

                    <div class="contract-section">
                        <div class="contract-section-title">CL√ÅUSULA QUARTA - DA ENTREGA</div>
                        <p>A entrega do bem ser√° realizada no prazo e condi√ß√µes estabelecidas entre as partes.</p>
                    </div>

                    <p style="margin-top: 60px;">[CIDADE], [DATA]</p>

                    <div style="margin-top: 80px; display: flex; justify-content: space-between;">
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractorName || '[VENDEDOR]'}</div>
                        </div>
                        <div style="text-align: center;">
                            <div>_______________________________</div>
                            <div>${data.contractedName || '[COMPRADOR]'}</div>
                        </div>
                    </div>
                `
            }
        };

        function initDB() {
            const request = indexedDB.open('KdefyDB', 1);
            
            request.onerror = () => console.error('Erro ao abrir banco de dados');
            
            request.onsuccess = (event) => {
                db = event.target.result;
                loadInitialData();
            };
            
            request.onupgradeneeded = (event) => {
                db = event.target.result;
                
                if (!db.objectStoreNames.contains('transactions')) {
                    const transactionStore = db.createObjectStore('transactions', { keyPath: 'id', autoIncrement: true });
                    transactionStore.createIndex('date', 'date', { unique: false });
                    transactionStore.createIndex('category', 'category', { unique: false });
                    transactionStore.createIndex('type', 'type', { unique: false });
                }
                
                if (!db.objectStoreNames.contains('categories')) {
                    const categoryStore = db.createObjectStore('categories', { keyPath: 'id', autoIncrement: true });
                    categoryStore.createIndex('name', 'name', { unique: true });
                }
                
                if (!db.objectStoreNames.contains('settings')) {
                    db.createObjectStore('settings', { keyPath: 'key' });
                }
            };
        }

        function loadInitialData() {
            loadCategories().then(() => {
                const transaction = db.transaction(['categories'], 'readonly');
                const store = transaction.objectStore('categories');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    if (request.result.length === 0) {
                        addDefaultCategories();
                    } else {
                        loadDashboard();
                        loadTransactions();
                        loadSettings();
                    }
                };
            });
        }

        function addDefaultCategories() {
            const defaultCategories = [
                { name: 'Sal√°rio', color: '#00C853' },
                { name: 'Alimenta√ß√£o', color: '#FF3D00' },
                { name: 'Transporte', color: '#5B2CFF' },
                { name: 'Moradia', color: '#FF6F00' },
                { name: 'Lazer', color: '#2196F3' },
                { name: 'Sa√∫de', color: '#E91E63' }
            ];
            
            const transaction = db.transaction(['categories'], 'readwrite');
            const store = transaction.objectStore('categories');
            
            defaultCategories.forEach(category => {
                store.add(category);
            });
            
            transaction.oncomplete = () => {
                loadDashboard();
                loadTransactions();
            };
        }

        async function loadCategories() {
            return new Promise((resolve) => {
                const transaction = db.transaction(['categories'], 'readonly');
                const store = transaction.objectStore('categories');
                const request = store.getAll();
                
                request.onsuccess = () => {
                    const categories = request.result;
                    updateCategorySelects(categories);
                    updateCategoryList(categories);
                    resolve();
                };
            });
        }

        function updateCategorySelects(categories) {
            const selects = [
                document.getElementById('transactionCategory'),
                document.getElementById('filterCategory')
            ];
            
            selects.forEach(select => {
                if (!select) return;
                const currentValue = select.value;
                const isFilter = select.id === 'filterCategory';
                
                select.innerHTML = isFilter ? '<option value="">Todas as categorias</option>' : '';
                
                categories.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = cat.name;
                    select.appendChild(option);
                });
                
                if (currentValue) select.value = currentValue;
            });
        }

        function updateCategoryList(categories) {
            const list = document.getElementById('categoryList');
            if (!list) return;
            
            list.innerHTML = categories.map(cat => `
                <div class="category-item" style="background: ${cat.color}20; border-color: ${cat.color};" 
                     onclick="editCategory(${cat.id})">
                    <div style="width: 40px; height: 40px; background: ${cat.color}; border-radius: 50%; margin: 0 auto;"></div>
                    <div class="category-name">${cat.name}</div>
                </div>
            `).join('');
        }

        function loadDashboard() {
            const transaction = db.transaction(['transactions', 'categories'], 'readonly');
            const transactionStore = transaction.objectStore('transactions');
            const categoryStore = transaction.objectStore('categories');
            
            const transactionRequest = transactionStore.getAll();
            const categoryRequest = categoryStore.getAll();
            
            Promise.all([
                new Promise(resolve => transactionRequest.onsuccess = () => resolve(transactionRequest.result)),
                new Promise(resolve => categoryRequest.onsuccess = () => resolve(categoryRequest.result))
            ]).then(([transactions, categories]) => {
                updateBalance(transactions);
                updateRecentTransactions(transactions.slice(-5).reverse(), categories);
                updateCharts(transactions, categories);
            });
        }

        function updateBalance(transactions) {
            const balance = transactions.reduce((acc, t) => {
                return t.type === 'income' ? acc + t.value : acc - t.value;
            }, 0);
            
            document.getElementById('totalBalance').textContent = 
                `R$ ${balance.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        }

        function updateRecentTransactions(transactions, categories) {
            const container = document.getElementById('recentTransactions');
            if (!container) return;
            
            if (transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhuma transa√ß√£o encontrada</p>';
                return;
            }
            
            const categoryMap = {};
            categories.forEach(cat => categoryMap[cat.id] = cat);
            
            container.innerHTML = transactions.map(t => {
                const category = categoryMap[t.category];
                const date = new Date(t.date).toLocaleDateString('pt-BR');
                
                return `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-category">${category?.name || 'Sem categoria'}</div>
                            <div class="transaction-date">${date} ${t.description ? '‚Ä¢ ' + t.description : ''}</div>
                        </div>
                        <div class="transaction-value ${t.type}">
                            ${t.type === 'income' ? '+' : '-'} R$ ${t.value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateCharts(transactions, categories) {
            const categoryMap = {};
            categories.forEach(cat => categoryMap[cat.id] = cat);
            
            const income = transactions.filter(t => t.type === 'income').reduce((acc, t) => acc + t.value, 0);
            const expense = transactions.filter(t => t.type === 'expense').reduce((acc, t) => acc + t.value, 0);
            
            const categoryData = {};
            transactions.forEach(t => {
                if (t.type === 'expense') {
                    const catName = categoryMap[t.category]?.name || 'Outros';
                    categoryData[catName] = (categoryData[catName] || 0) + t.value;
                }
            });
            
            if (charts.incomeExpense) charts.incomeExpense.destroy();
            const ctx1 = document.getElementById('incomeExpenseChart');
            if (ctx1) {
                charts.incomeExpense = new Chart(ctx1, {
                    type: 'doughnut',
                    data: {
                        labels: ['Entradas', 'Sa√≠das'],
                        datasets: [{
                            data: [income, expense],
                            backgroundColor: ['#00C853', '#FF3D00']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            if (charts.category) charts.category.destroy();
            const ctx2 = document.getElementById('categoryChart');
            if (ctx2) {
                charts.category = new Chart(ctx2, {
                    type: 'pie',
                    data: {
                        labels: Object.keys(categoryData),
                        datasets: [{
                            data: Object.values(categoryData),
                            backgroundColor: Object.keys(categoryData).map(name => {
                                const cat = categories.find(c => c.name === name);
                                return cat?.color || '#5B2CFF';
                            })
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            updateReportCharts(transactions, categories);
        }

        function updateReportCharts(transactions, categories) {
            const monthlyData = {};
            transactions.forEach(t => {
                const month = new Date(t.date).toLocaleDateString('pt-BR', { year: 'numeric', month: 'short' });
                if (!monthlyData[month]) {
                    monthlyData[month] = { income: 0, expense: 0 };
                }
                if (t.type === 'income') {
                    monthlyData[month].income += t.value;
                } else {
                    monthlyData[month].expense += t.value;
                }
            });
            
            const months = Object.keys(monthlyData).sort();
            
            if (charts.monthly) charts.monthly.destroy();
            const ctx3 = document.getElementById('monthlyChart');
            if (ctx3) {
                charts.monthly = new Chart(ctx3, {
                    type: 'line',
                    data: {
                        labels: months,
                        datasets: [
                            {
                                label: 'Entradas',
                                data: months.map(m => monthlyData[m].income),
                                borderColor: '#00C853',
                                backgroundColor: '#00C85320',
                                tension: 0.4
                            },
                            {
                                label: 'Sa√≠das',
                                data: months.map(m => monthlyData[m].expense),
                                borderColor: '#FF3D00',
                                backgroundColor: '#FF3D0020',
                                tension: 0.4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        }
                    }
                });
            }
            
            const categoryMap = {};
            categories.forEach(cat => categoryMap[cat.id] = cat);
            
            const categoryExpenses = {};
            transactions.filter(t => t.type === 'expense').forEach(t => {
                const catName = categoryMap[t.category]?.name || 'Outros';
                categoryExpenses[catName] = (categoryExpenses[catName] || 0) + t.value;
            });
            
            if (charts.categoryBar) charts.categoryBar.destroy();
            const ctx4 = document.getElementById('categoryBarChart');
            if (ctx4) {
                charts.categoryBar = new Chart(ctx4, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(categoryExpenses),
                        datasets: [{
                            label: 'Gastos por Categoria',
                            data: Object.values(categoryExpenses),
                            backgroundColor: Object.keys(categoryExpenses).map(name => {
                                const cat = categories.find(c => c.name === name);
                                return cat?.color || '#5B2CFF';
                            })
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }

        function loadTransactions() {
            const transaction = db.transaction(['transactions', 'categories'], 'readonly');
            const transactionStore = transaction.objectStore('transactions');
            const categoryStore = transaction.objectStore('categories');
            
            const transactionRequest = transactionStore.getAll();
            const categoryRequest = categoryStore.getAll();
            
            Promise.all([
                new Promise(resolve => transactionRequest.onsuccess = () => resolve(transactionRequest.result)),
                new Promise(resolve => categoryRequest.onsuccess = () => resolve(categoryRequest.result))
            ]).then(([transactions, categories]) => {
                const startDate = document.getElementById('filterStartDate')?.value;
                const endDate = document.getElementById('filterEndDate')?.value;
                const categoryFilter = document.getElementById('filterCategory')?.value;
                
                let filtered = transactions;
                
                if (startDate) {
                    filtered = filtered.filter(t => t.date >= startDate);
                }
                
                if (endDate) {
                    filtered = filtered.filter(t => t.date <= endDate);
                }
                
                if (categoryFilter) {
                    filtered = filtered.filter(t => t.category == categoryFilter);
                }
                
                updateTransactionsList(filtered.reverse(), categories);
            });
        }

        function updateTransactionsList(transactions, categories) {
            const container = document.getElementById('allTransactions');
            if (!container) return;
            
            if (transactions.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Nenhuma transa√ß√£o encontrada</p>';
                return;
            }
            
            const categoryMap = {};
            categories.forEach(cat => categoryMap[cat.id] = cat);
            
            container.innerHTML = transactions.map(t => {
                const category = categoryMap[t.category];
                const date = new Date(t.date).toLocaleDateString('pt-BR');
                
                return `
                    <div class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-category">${category?.name || 'Sem categoria'}</div>
                            <div class="transaction-date">${date} ${t.description ? '‚Ä¢ ' + t.description : ''}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <div class="transaction-value ${t.type}">
                                ${t.type === 'income' ? '+' : '-'} R$ ${t.value.toLocaleString('pt-BR', { minimumFractionDigits: 2 })}
                            </div>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 12px;" onclick="editTransaction(${t.id})">Editar</button>
                            <button class="btn btn-expense" style="padding: 6px 12px; font-size: 12px;" onclick="deleteTransaction(${t.id})">Excluir</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openTransactionModal(id = null) {
            currentTransactionId = id;
            const modal = document.getElementById('transactionModal');
            const form = document.getElementById('transactionForm');
            const title = document.getElementById('transactionModalTitle');
            
            title.textContent = id ? 'Editar Transa√ß√£o' : 'Adicionar Transa√ß√£o';
            
            if (id) {
                const transaction = db.transaction(['transactions'], 'readonly');
                const store = transaction.objectStore('transactions');
                const request = store.get(id);
                
                request.onsuccess = () => {
                    const t = request.result;
                    document.getElementById('transactionId').value = t.id;
                    document.getElementById('transactionType').value = t.type;
                    document.getElementById('transactionValue').value = t.value;
                    document.getElementById('transactionCategory').value = t.category;
                    document.getElementById('transactionDate').value = t.date;
                    document.getElementById('transactionDescription').value = t.description || '';
                };
            } else {
                form.reset();
                document.getElementById('transactionDate').value = new Date().toISOString().split('T')[0];
            }
            
            modal.classList.add('active');
        }

        function closeTransactionModal() {
            document.getElementById('transactionModal').classList.remove('active');
            document.getElementById('transactionForm').reset();
            currentTransactionId = null;
        }

        function saveTransaction(event) {
            event.preventDefault();
            
            const transactionData = {
                type: document.getElementById('transactionType').value,
                value: parseFloat(document.getElementById('transactionValue').value),
                category: parseInt(document.getElementById('transactionCategory').value),
                date: document.getElementById('transactionDate').value,
                description: document.getElementById('transactionDescription').value
            };
            
            const transaction = db.transaction(['transactions'], 'readwrite');
            const store = transaction.objectStore('transactions');
            
            if (currentTransactionId) {
                transactionData.id = currentTransactionId;
                store.put(transactionData);
            } else {
                store.add(transactionData);
            }
            
            transaction.oncomplete = () => {
                closeTransactionModal();
                loadDashboard();
                loadTransactions();
            };
        }

        function editTransaction(id) {
            openTransactionModal(id);
        }

        function deleteTransaction(id) {
            if (!confirm('Deseja realmente excluir esta transa√ß√£o?')) return;
            
            const transaction = db.transaction(['transactions'], 'readwrite');
            const store = transaction.objectStore('transactions');
            store.delete(id);
            
            transaction.oncomplete = () => {
                loadDashboard();
                loadTransactions();
            };
        }

        function openCategoryModal(id = null) {
            const modal = document.getElementById('categoryModal');
            const form = document.getElementById('categoryForm');
            
            if (id) {
                const transaction = db.transaction(['categories'], 'readonly');
                const store = transaction.objectStore('categories');
                const request = store.get(id);
                
                request.onsuccess = () => {
                    const cat = request.result;
                    document.getElementById('categoryId').value = cat.id;
                    document.getElementById('categoryName').value = cat.name;
                    document.getElementById('categoryColor').value = cat.color;
                    document.getElementById('colorValue').textContent = cat.color;
                };
            } else {
                form.reset();
                document.getElementById('categoryColor').value = '#5B2CFF';
                document.getElementById('colorValue').textContent = '#5B2CFF';
            }
            
            modal.classList.add('active');
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
            document.getElementById('categoryForm').reset();
        }

        function saveCategory(event) {
            event.preventDefault();
            
            const categoryData = {
                name: document.getElementById('categoryName').value,
                color: document.getElementById('categoryColor').value
            };
            
            const id = document.getElementById('categoryId').value;
            
            const transaction = db.transaction(['categories'], 'readwrite');
            const store = transaction.objectStore('categories');
            
            if (id) {
                categoryData.id = parseInt(id);
                store.put(categoryData);
            } else {
                store.add(categoryData);
            }
            
            transaction.oncomplete = () => {
                closeCategoryModal();
                loadCategories();
                loadDashboard();
            };
        }

        function editCategory(id) {
            openCategoryModal(id);
        }

        document.getElementById('categoryColor')?.addEventListener('input', (e) => {
            document.getElementById('colorValue').textContent = e.target.value;
        });

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            document.getElementById(sectionId)?.classList.add('active');
            event.target.classList.add('active');
        }

        function toggleTheme() {
            const isDark = document.getElementById('themeToggle').checked;
            document.documentElement.setAttribute('data-theme', isDark ? 'dark' : 'light');
            
            const transaction = db.transaction(['settings'], 'readwrite');
            const store = transaction.objectStore('settings');
            store.put({ key: 'theme', value: isDark ? 'dark' : 'light' });
        }

        function loadSettings() {
            const transaction = db.transaction(['settings'], 'readonly');
            const store = transaction.objectStore('settings');
            const request = store.get('theme');
            
            request.onsuccess = () => {
                const theme = request.result?.value || 'light';
                document.documentElement.setAttribute('data-theme', theme);
                document.getElementById('themeToggle').checked = theme === 'dark';
            };
        }

        function exportData() {
            const transaction = db.transaction(['transactions', 'categories', 'settings'], 'readonly');
            
            const data = {};
            
            const promises = ['transactions', 'categories', 'settings'].map(storeName => {
                return new Promise((resolve) => {
                    const store = transaction.objectStore(storeName);
                    const request = store.getAll();
                    request.onsuccess = () => {
                        data[storeName] = request.result;
                        resolve();
                    };
                });
            });
            
            Promise.all(promises).then(() => {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `kdefy-backup-${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
            });
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    const transaction = db.transaction(['transactions', 'categories', 'settings'], 'readwrite');
                    
                    ['transactions', 'categories', 'settings'].forEach(storeName => {
                        const store = transaction.objectStore(storeName);
                        const clearRequest = store.clear();
                        
                        clearRequest.onsuccess = () => {
                            if (data[storeName]) {
                                data[storeName].forEach(item => {
                                    store.add(item);
                                });
                            }
                        };
                    });
                    
                    transaction.oncomplete = () => {
                        alert('Dados importados com sucesso!');
                        location.reload();
                    };
                } catch (error) {
                    alert('Erro ao importar dados. Verifique o arquivo.');
                }
            };
            
            reader.readAsText(file);
        }

        function clearAllData() {
            if (!confirm('Tem certeza que deseja limpar TODOS os dados? Esta a√ß√£o n√£o pode ser desfeita!')) return;
            
            const transaction = db.transaction(['transactions', 'categories', 'settings'], 'readwrite');
            
            ['transactions', 'categories', 'settings'].forEach(storeName => {
                const store = transaction.objectStore(storeName);
                store.clear();
            });
            
            transaction.oncomplete = () => {
                alert('Todos os dados foram removidos.');
                location.reload();
            };
        }

        function updateContractPreview() {
            const type = document.getElementById('contractType').value;
            const template = contractTemplates[type];
            
            const data = {
                contractorName: document.getElementById('contractorName').value,
                contractorDoc: document.getElementById('contractorDoc').value,
                contractedName: document.getElementById('contractedName').value,
                contractedDoc: document.getElementById('contractedDoc').value,
                contractValue: document.getElementById('contractValue').value,
                contractObject: document.getElementById('contractObject').value
            };
            
            const preview = document.getElementById('contractPreview');
            preview.innerHTML = `
                <div class="contract-header">
                    <div class="contract-title">${template.title}</div>
                </div>
                ${template.content(data)}
            `;
        }

        function copyContract() {
            const contractText = document.getElementById('contractPreview').innerText;
            navigator.clipboard.writeText(contractText).then(() => {
                alert('Contrato copiado para a √°rea de transfer√™ncia!');
            }).catch(() => {
                alert('Erro ao copiar contrato.');
            });
        }

        function downloadContractPDF() {
            window.print();
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainWrapper = document.getElementById('mainWrapper');
            const openBtn = document.getElementById('sidebarOpenBtn');
            
            sidebar.classList.toggle('collapsed');
            mainWrapper.classList.toggle('expanded');
            openBtn.classList.toggle('visible');
        }

        const canvas = document.createElement('canvas');
        canvas.width = 32;
        canvas.height = 32;
        const ctx = canvas.getContext('2d');
        ctx.fillStyle = '#5B2CFF';
        ctx.fillRect(0, 0, 32, 32);
        ctx.fillStyle = '#ffffff';
        ctx.font = 'bold 20px Arial';
        ctx.fillText('K', 8, 24);
        const link = document.createElement('link');
        link.rel = 'icon';
        link.href = canvas.toDataURL();
        document.head.appendChild(link);

        initDB();
        updateContractPreview();
    </script>
</body>
</html>
